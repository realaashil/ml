import gymnasium as gym
import numpy as np

env = gym.make("FrozenLake-v1", is_slippery=False)   # deterministic for learning
n_states = env.observation_space.n
n_actions = env.action_space.n

Q = np.zeros((n_states, n_actions))

alpha = 0.8       # learning rate
gamma = 0.95      # discount factor
epsilon = 0.1     # exploration

episodes = 2000

def epsilon_greedy_policy(state):
    if np.random.rand() < epsilon:
        return env.action_space.sample()
    return np.argmax(Q[state])

for ep in range(episodes):
    state, _ = env.reset()
    done = False

    while not done:
        action = epsilon_greedy_policy(state)
        next_state, reward, terminated, truncated, _ = env.step(action)
        done = terminated or truncated

        # Q-learning update (off-policy)
        best_next_action = np.argmax(Q[next_state])
        Q[state, action] += alpha * (reward + gamma * Q[next_state, best_next_action] - Q[state, action])

        state = next_state

print("Trained Q-table:\n", Q)
